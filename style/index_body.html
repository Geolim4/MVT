<div id="notepad">
	<h3>
		<span onclick="$('#notepad').removeClass('reduced');$('#notepad').draggable({axis: null, handle: '#notepad-handle'});reset_notepad_pos();">{L_MVT_NOTEPAD_TITLE}</span>
		<a href="javascript:void(0);" onclick="$('#notepad').toggle(300);$('#btn_notepad').children('a').removeClass('active');" class="button">x</a>
		<a href="javascript:void(0);" onclick="$('#notepad').addClass('reduced');$('#notepad').effect('highlight', {color:'#669966'}, 1500);$('#notepad').draggable({axis: 'x', handle: '#notepad-handle'});" class="button">-</a>
		<a id="notepad-handle" href="javascript:void(0);" class="button display-on-reduced" style="cursor: move;">{L_MVT_DRAG_BUTTON}</a>
	</h3>
	<textarea id="notepad-report" class="inputbox" tabindex="3" cols="76" rows="7" name="message" style="height: 9em;"></textarea>
</div>
<div id="tools-sticker"></div>
<div id="tools">
	<ul>
		<li id="btn_enc_eol"><a href="#" class="btn" onclick="return false;"><span id="file-encoding"></span>&nbsp;|&nbsp;<span id="file-eol"></span></a></li>
		<li class="separator">|</li>
		<li id="btn_list_numbers"><a href="#" class="btn" onclick="btn_list_numbers(); return false;" title="{L_MVT_LIST_NUMBERS}" ><img alt="{L_MVT_LIST_NUMBERS}" src="style/images/list-numbers.png" /></a></li>
		<li id="btn_list_breakline"><a href="#" class="btn" onclick="btn_list_breakline(); return false;" title="{L_MVT_LIST_LINEBREAK}" ><img alt="{L_MVT_LIST_LINEBREAK}" src="style/images/list-linebreak.png" /></a></li>
		<li id="btn_left_scroll"><a href="#" class="btn" onclick="left_scroll(); return false;" title="{L_MVT_SCROLL_LEFT}" ><img alt="{L_MVT_SCROLL_LEFT}" src="style/images/scroll_left.png" /></a></li>
		<li id="btn_right_scroll"><a href="#" class="btn" onclick="right_scroll(); return false;" title="{L_MVT_SCROLL_RIGHT}"><img alt="{L_MVT_SCROLL_RIGHT}" src="style/images/scroll_right.png" /></a></li>
		<li id="btn_top_scroll"><a href="#" class="btn" onclick="top_scroll(); return false;" title="{L_MVT_SCROLL_TOP}"><img alt="{L_MVT_SCROLL_TOP}" src="style/images/scroll_up.png" /></a></li>
		<li id="btn_down_scroll"><a href="#" class="btn" onclick="down_scroll(); return false;" title="{L_MVT_SCROLL_DOWN}"><img alt="{L_MVT_SCROLL_DOWN}" src="style/images/scroll_down.png" /></a></li>
		<li class="separator">|</li>
		<li id="btn_fullscreen"><a href="#" class="btn" onclick="btn_fullscreen(); return false;" title="{L_MVT_FULLSCREEN}"><img alt="{L_MVT_SELECT_ALL}" src="style/images/fullscreen.png" /></a></li>
		<li id="btn_select_code"><a href="#" class="btn" onclick="selectCode(document.getElementById('code-content'), $('#code-content').children().first().prop('tagName')); return false;" title="{L_MVT_SELECT_ALL}"><img alt="{L_MVT_SELECT_ALL}" src="style/images/select_all.png" /></a></li>
		<li id="btn_notepad"><a href="#" class="btn" onclick="$('#notepad').show(300); $(this).addClass('active'); $('#notepad-report').autosize(); return false;" id="notepad-button" title="{L_MVT_OPEN_NOTEPAD}"><img alt="{L_MVT_OPEN_NOTEPAD}" src="style/images/notepad.png" /></a></li>
		<li id="btn_purge_notepad"><a href="#" class="btn" onclick="purge_notepad(); return false;" id="notepad-purge" title="{L_MVT_PURGE}"><img alt="{L_MVT_PURGE}" src="style/images/purge.png" /></a></li>
		<li class="separator">|</li>
		<li id="btn_report_notice"><a href="#" class="btn uppercase" onclick="report_code('[color=blue][ {L_MVT_TAG_NOTICE} ][/color]'); return false;" title="{L_MVT_TAG_NOTICE}"><strong style="color: blue;">[&nbsp;{L_MVT_TAG_NOTICE}&nbsp;]</strong></a></li>
		<li id="btn_report_warning"><a href="#" class="btn uppercase" onclick="report_code('[color=orange][ {L_MVT_TAG_WARNING} ][/color]'); return false;" title="{L_MVT_TAG_WARNING}"><strong style="color: orange;">[&nbsp;{L_MVT_TAG_WARNING}&nbsp;]</strong></a></li>
		<li id="btn_report_fail"><a href="#" class="btn uppercase" onclick="report_code('[color=red][ {L_MVT_TAG_FAIL} ][/color]'); return false;" title="{L_MVT_TAG_FAIL}"><strong style="color: red;">[&nbsp;{L_MVT_TAG_FAIL}&nbsp;]</strong></a></li>
		<li id="btn_internal_mesage"><a href="#" class="btn" onclick="internal_mesage(); return false;" id="internal-button" title="{L_MVT_INTERNAL}"><img alt="{L_MVT_INTERNAL}" src="style/images/internal.png" /></a></li>
		<li id="btn_filename"><a href="#" class="btn" onclick="insert_filename(); return false;" id="filename-button" title="{L_MVT_INSERT_FILENAME}"><img alt="{L_MVT_INSERT_FILENAME}" src="style/images/filename.png" /></a></li>
		<li class="separator">|</li>
		<!-- IF .version_selector --><li id="btn_compare"><a href="#" class="btn" onclick="btn_compare(); return false;" id="compare-button" title="{L_MVT_COMPARE}"><img alt="{L_MVT_COMPARE}" src="style/images/compare.png" /></a></li><!-- ENDIF -->
		<li id="btn_filestats"><a href="#" class="btn" onclick="get_filestats(); return false;" id="filestats-button" title="{L_MVT_FILESTATS}"><img alt="{L_MVT_FILESTATS}" src="style/images/filestats.png" /></a></li>
		<li id="btn_search_engine"><a href="#" class="btn" onclick="search_engine(); return false;" title="{L_MVT_SEARCH_ENGINE}"><img alt="{L_MVT_SEARCH_ENGINE}" src="style/images/{S_CFG_SEARCH_ENGINE_IMG}" /></a></li>
		<li id="btn_base64_decode"><a href="#" class="btn" onclick="base64_decode(); return false;" title="{L_MVT_BASE64_DECODE}"><img alt="{L_MVT_BASE64_DECODE}" src="style/images/base64.png" /></a></li>
		<!-- IF S_CFG_SYNTAX --><li id="btn_check_syntax"><a href="#" class="btn" onclick="check_syntax(); return false;" title="{L_MVT_PHP_SYNTAX}"><img alt="{L_MVT_PHP_SYNTAX}" src="style/images/php_syntax.png" /></a></li><!-- ENDIF -->
	</ul>
</div>
<p class="clear"></p>
<span id="breadcrumb">{S_BREADCRUMB}</span>
<span id="version-differentiator"></span>

<p class="clear"></p>
<div class="code-content" id="code-content">
<p class="loading"><img alt="{LA_MVT_LOADING}" src="style/images/loading.gif"></p>
</div>
<div id="dialogbox">
	<div></div><br />
	<textarea class="inputbox text ui-widget-content ui-corner-all" id="user-report" tabindex="3" cols="75" rows="5" name="message" style="height: 90px;width: 470px;resize: none;"></textarea>
</div>
<div id="infobox"><div></div></div>
<div id="confirmbox"><div></div></div>
<div id="filterbox">
	<div class="d-inline-block"></div>
	<div class="f-right">
		<select name="filter-select" id="filter-select" multiple="multiple" size="10" onchange="tree_count_filters(this.id)">
			<!-- IF .version_selector -->
			<optgroup label="File updated">
				<!-- BEGIN version_selector -->
					<!-- IF S_CURRENT_MOD_VERSION != version_selector.VERSION_ID -->
						<option value="version-{version_selector.VERSION_DIR}" class="option-<!-- IF version_selector.PHPBB_VERSION == '3.0.x' -->30x<!-- ELSE IF version_selector.PHPBB_VERSION == '3.1.x' -->31x<!-- ENDIF -->">{version_selector.VERSION_ID}</option><!-- ENDIF -->
				<!-- END version_selector -->
			</optgroup>
			<!-- ENDIF -->
			<!-- BEGIN compare_sort -->
				<optgroup label="{compare_sort.OPTGROUP_LABEL}"> 
				<!-- BEGIN ext -->
					<option value="{compare_sort.ext.EXT_CODE}">{compare_sort.ext.EXT_NAME}</option>
				<!-- END compare_sort -->
				</optgroup>
			<!-- END compare_sort -->
		</select>
	</div>
</div>

<!-- INCLUDE javascript_core.html -->
<script type="text/javascript">
// <![CDATA[
$(document).ready(function() {
	init();
});

function init(){
	 $(function() {
		$('.btn').tooltip({
			 show: {
				delay: 400
			},
			position: {
				my: "center bottom-30",
				at: "center bottom",
			},
		});
	});
	if($.cookie(hide_list_cookie_name)){
		btn_list_numbers();
	}
	if($.cookie(breakline_cookie_name)){
		btn_list_breakline();
	}
	$(document).keydown(function(e)
	{
		if (e.keyCode == ctrlKey) ctrlDown = true;
	}).keyup(function(e)
	{
		if (e.keyCode == ctrlKey) ctrlDown = false;
	});
	set_button_status();
	for (key in current_path_anchor){
		expanded_folders += current_path_anchor[key] + '/';
		current_tree_path[key] = '{S_CURRENT_MOD}/' + expanded_folders;
	}
	$('#file-tree').fileTree({
			root:'{S_CURRENT_MOD}/',
			options: tree_filter,
			multiFolder: true,
			script: '{U_FILE_TREE}',
			loadMessage : 'Wait...',
			expandSpeed : 300,
			collapseSpeed : 150,
			expandedFolders: current_tree_path,
		},
		function(file) {
			set_active_file(file.replace('{S_CURRENT_MOD}/', ''));
		}
	);
	//Wait for Jquery fileTree finish the job
	setTimeout(function() {
		if(current_file_anchor){
			set_active_file(current_file_anchor);
		}else{
			set_active_file(current_file);
		}
	}, 500);
	$("#notepad").draggable({handle: "#notepad-handle", containment: "#wrap"});
	$(function () {
		$(window).scroll(berstick);
		berstick();
	});
	$(window).resize(function() {
		berstick(true);
		reset_notepad_pos();
	});
	$('html, body').animate({
		scrollTop: $("#acp").last().offset().top
	}, 250);
	<!-- IF not S_CFG_NEW_TAB and S_CFG_EXIT_HANDLER -->
	$('#tabs').find("a.mods-links").click(function(){
		exit_handler(this.href);
		return false;
	});
	if ("onhashchange" in window) { // event supported?
		window.onhashchange = function () {
			if(hash_ignore_update){
				hash_ignore_update = false;
				return;
			}
			current_file_anchor = window.location.hash.replace('#/', '').replace('#', '');
			current_path_anchor = window.location.hash ? current_file_anchor.replace(strrchr(window.location.hash.replace('#', ''), '/'), '').split('/') : current_file.split('/');
			if(current_file_anchor){
				set_active_file(current_file_anchor, true);
			}else{
				set_active_file('{S_CURRENT_FILE}', true);
			}
		}
	}
	else { // event not supported:
		var storedHash = window.location.hash;
		window.setInterval(function () {
			if (window.location.hash != storedHash) {
				if(hash_ignore_update){
					hash_ignore_update = false;
					return;
				}
				current_file_anchor = window.location.hash.replace('#/', '').replace('#', '');
				current_path_anchor = window.location.hash ? current_file_anchor.replace(strrchr(window.location.hash.replace('#', ''), '/'), '').split('/') : current_file.split('/');
				if(current_file_anchor){
					set_active_file(current_file_anchor);
				}else{
					set_active_file('{S_CURRENT_FILE}');
				}
			}
		}, 100);
	}
	<!-- ENDIF -->
	<!-- IF S_CFG_EXIT_HANDLER -->
	mvt_service('notepad_report_checker', notepad_report_checker, 1000, 'start');
	<!-- ENDIF -->
	mvt_service('fullscreen_handler', fullscreen_handler, 500, 'start');
	mvt_service('reset_file_selected', reset_file_selected, 250, 'start');

	tree_count_filters('filter-select');
	file_encoding(current_mod, current_file, false);
	file_eol(current_mod, current_file, false);
}

function btn_compare(mod_to, file_to, diff_mode){

	//Reset step if we're already comparing some files...
	if($('#btn_compare').children('a').hasClass('active')){
		$('#btn_compare').children('a').removeClass('active');
		set_active_file(current_file);
		return;
	}
	if(mod_to && file_to && diff_mode){
		if(busy){
			return;
		}
		$.ajax({
			type: 'POST',
			url: '{U_AJAX}',
			data: {'mode': 'compare', 'diff_mode' : diff_mode, 'mod': current_mod, 'file': current_file, 'mod_to': mod_to, 'file_to': file_to},
			timeout: 5000,
			dataType  : 'json',
			beforeSend: function() {
				busy = true;
				$("#code-content").html('<p class="loading"><img alt="{LA_MVT_LOADING}" src="style/images/loading.gif"></p>');
			},
			complete: function(data, textStts, errThrown) {
				busy = false;
			},
			success: function(data, textStts, errThrown) {
				if(data['eval']){
					eval(data['eval']);
					setTimeout(function(){
						set_active_file(current_file);
					}, 750);
				}else if(data['diff']){
					$('#code-content').html(data['diff']);
					$('#btn_compare').children('a').addClass('active');
					btn_list_numbers(true);
				}
			},
			error: function(data, textStts, errThrown) {

			},
		});
	}else{
		mvt_confirm("{LA_MVT_COMPARE}", '{LA_MVT_MOD_VERSION_COMPARE}:&nbsp;&nbsp;&nbsp;' +
			'<select id="mod-version-compare">' +
			<!-- BEGIN version_selector -->
			<!-- IF S_CURRENT_MOD_VERSION != version_selector.VERSION_ID -->'<option<!-- IF version_selector.S_SELECTED --> selected="selected"<!-- ENDIF --> value="{version_selector.VERSION_DIR}" class="option-<!-- IF version_selector.PHPBB_VERSION == '3.0.x' -->30x<!-- ELSE IF version_selector.PHPBB_VERSION == '3.1.x' -->31x<!-- ENDIF -->">{version_selector.VERSION_ID}</option>' + <!-- ENDIF -->
			<!-- END version_selector -->
			'</select><br /><br />' +
			'{LA_MVT_COMPARE_SELECT}:&nbsp;&nbsp;&nbsp;<select id="mod-diff-mode">{S_DIFF_MODES}</select>', 
			function () {
				btn_compare($("#mod-version-compare").val(), current_file, $("#mod-diff-mode").val());
				$("#mod-version-compare, #mod-diff-mode").remove();
			}, 
			function () {
				//Nope
			}
		);
	}
}

function btn_fullscreen(){
	var acp_element = document.getElementById("acp");
	if(acp_element.requestFullScreen || acp_element.webkitRequestFullScreen || acp_element.mozRequestFullScreen){
		if (RunPrefixMethod(document, "FullScreen") || RunPrefixMethod(document, "IsFullScreen")) {
			RunPrefixMethod(document, "CancelFullScreen");
			$('#btn_fullscreen').children('a').removeClass('active');
		}
		else {
			RunPrefixMethod(acp_element, "RequestFullScreen");
			$('#btn_fullscreen').children('a').addClass('active');
		}
	}else{
		mvt_info('{LA_MVT_FULLSCREEN_UNSUPPORTED}');
	}
}

function reset_notepad_pos(){
	var pos = $(window).width() - $('#notepad').width() - 50;
	$('#notepad').css('left', pos + 'px');
	$('#notepad').css('top', '25px');
}

function btn_list_numbers(force){
	if($('#code-content').hasClass('no-style-type') && !force){
		$.removeCookie(hide_list_cookie_name, {path: '/'});
		$('#code-content').removeClass('no-style-type');
		$('#btn_list_numbers').children('a').removeClass('active');
	}else{
		$.cookie(hide_list_cookie_name, true, {path: '/'});
		$('#code-content').addClass('no-style-type');
		$('#btn_list_numbers').children('a').addClass('active');
	}
}
function btn_list_breakline(force){
	if($('#code-content').hasClass('breakline') && !force){
		$.removeCookie(breakline_cookie_name, {path: '/'});
		$('#btn_left_scroll, #btn_right_scroll').show();
		$('#code-content').removeClass('breakline');
		$('#btn_list_breakline').children('a').removeClass('active');
	}else{
		$.cookie(breakline_cookie_name, true, {path: '/'});
		$('#btn_left_scroll, #btn_right_scroll').hide();
		$('#code-content').addClass('breakline');
		$('#btn_list_breakline').children('a').addClass('active');
	}
}

function left_scroll(){
	var scroll_value = ctrlDown ? '-=9999' : '-=150';
	$('#code-content').animate({
		scrollLeft: scroll_value
	}, 150);
}

function right_scroll(){
	var scroll_value = ctrlDown ? '+=9999' : '+=150';
	$('#code-content').animate({
		scrollLeft: scroll_value
	}, 150);
}

function top_scroll(){
	var scroll_value = ctrlDown ? '-=9999' : '-=300';
	$('#code-content').animate({
		scrollTop: scroll_value
	}, 150);
}

function down_scroll(){
	var scroll_value = ctrlDown ? '+=9999' : '+=300';
	$('#code-content').animate({
		scrollTop: scroll_value
	}, 150);
}

function previous_file(){
	var file_found = false, break_traversing = false;
	//Hide the current button
	$('#previous_file').hide();
	//Re-enable the opposite button
	$('#next_file').show();

	$($("a.tree-link").get().reverse()).each(function() {
		if(break_traversing){
			//If a previous file is found then re-enable the current button
			$('#previous_file').show();
			return;
		}else if(file_found){
			window.location.hash = $(this).attr('href');
			current_file_anchor = window.location.hash.replace('#/', '').replace('#', '');
			current_path_anchor = window.location.hash ? current_file_anchor.replace(strrchr(window.location.hash.replace('#', ''), '/'), '').split('/') : current_file.split('/');
			set_active_file(current_file_anchor);
			break_traversing =  true;
		}
		else
		{
			if($(this).hasClass("tree-selected")){
				file_found = true;
			}
		}
	});
}

function next_file(){
	var file_found = false, break_traversing = false;
	//Hide the current button
	$('#next_file').hide();
	//Re-enable the opposite button
	$('#previous_file').show();

	$("a.tree-link").each(function() {
		if(break_traversing){
			//If a next file is found then re-enable the current button
			$('#next_file').show();
			return;
		}else if(file_found){
			window.location.hash = $(this).attr('href');
			current_file_anchor = window.location.hash.replace('#/', '').replace('#', '');
			current_path_anchor = window.location.hash ? current_file_anchor.replace(strrchr(window.location.hash.replace('#', ''), '/'), '').split('/') : current_file.split('/');
			set_active_file(current_file_anchor);
			break_traversing =  true;
		}
		else
		{
			if($(this).hasClass("tree-selected")){
				file_found = true;
			}
		}
	});
}

function search_engine(){
	var SelectedCode = getSelectedCode(), engine_url = "{S_CFG_SEARCH_ENGINE_URL}";
	if(!SelectedCode){
		alert('{LA_MVT_SELECT_ERROR}');
	}else{
		window.open(engine_url.replace('%CODE%', SelectedCode.substr(0, 120)));
	}
}

function base64_decode(){
	var SelectedCode = getSelectedCode();
	if(!SelectedCode){
		alert('{LA_MVT_SELECT_ERROR}');
	}else if (/*SelectedCode.substr(SelectedCode.length - 2) != '==' ||*/ !/^[a-zA-Z0-9=]+$/.test(SelectedCode)){
		alert('{LA_MVT_INVALID_BASE64}');
	}else{
		mvt_info('{LA_INFORMATION}', base64_decoder(SelectedCode));
	}
}

function tree_count_filters(selector_id){
	if($('#' + selector_id).children().children('option:selected').length){
		$('#filter-count').text('(' + $('#' + selector_id).children().children('option:selected').length + ')');
	}else{
		$('#filter-count').text('');
	}
}

function file_tree_filter(confirm){
	if(!confirm){
		mvt_confirm("{LA_MVT_FILTER}", "{LA_MVT_FILTER_EXPLAIN}", 
			function () {
				file_tree_filter(true);
			}, 
			function () {
			}, 
			false, '#filterbox', false, false,
			function () {
				$("#filter-select").children().children('option').each(function(index) {
					this.selected = false;
				});
				tree_count_filters('filter-select');
			}
		);
	}else{
		tree_filter = $('#filter-select').val();
		collapse_all(true);
	}
}

function collapse_all(force_collaspe){
	if(menu_state == 'hidden' && !force_collaspe){
		return;
	}
	current_file_anchor = window.location.hash.replace('#/', '').replace('#', '');
	current_path_anchor = window.location.hash ? current_file_anchor.replace(strrchr(window.location.hash.replace('#', ''), '/'), '').split('/') : current_file.split('/');
	current_tree_path = new Array(), expanded_folders = '';
	for (key in current_path_anchor){
		expanded_folders += current_path_anchor[key] + '/';
		current_tree_path[key] = '{S_CURRENT_MOD}/' + expanded_folders;
	}
	$('#file-tree').fileTree({
			root:'{S_CURRENT_MOD}/',
			options: tree_filter,
			multiFolder: true,
			script: '{U_FILE_TREE}',
			loadMessage : 'Wait...',
			expandSpeed : 300,
			collapseSpeed : 150,
			expandedFolders: current_tree_path,
		},
		function(file) {
			set_active_file(file.replace('{S_CURRENT_MOD}/', ''));
		}
	);
	$('html, body').animate({
		scrollTop: $("#tabs").offset().top
	}, 800);
}

function expand_all(){
	if(busy){
		return;
	}
	$.ajax({
		type: 'POST',
		url: '{U_AJAX}',
		data: {'mod' : current_mod, 'mode' : 'tree_all'},
		timeout: 5000,
		dataType  : 'json',
		beforeSend: function() {
			busy = true;
		},
		complete: function(data, textStts, errThrown) {
			busy = false;
		},
		success: function(data, textStts, errThrown) {
			$('#file-tree').fileTree({
					root:'{S_CURRENT_MOD}/',
					options: tree_filter,
					multiFolder: true,
					script: '{U_FILE_TREE}',
					loadMessage : 'Wait...',
					expandSpeed : 300,
					collapseSpeed : 150,
					expandedFolders: data,
				},
				function(file) {
					set_active_file(file.replace('{S_CURRENT_MOD}/', ''));
				}
			);
		},
		error: function(data, textStts, errThrown) {

		},
	});
}

function reset_file_selected(delay){
	if(delay){
		var timedelay = delay;
	} else {
		var timedelay = 250;
	}
	setTimeout(function() {
		$(".tree-selected").removeClass("tree-selected");
		$("a[href='#" + current_file + "']").addClass("tree-selected");
		$('ul.jqueryFileTree').find("a").children('span.tree-external').attr("onclick", "window.open(this.parentNode.href);");
		setTimeout(function() {
		}, 500);
	}, timedelay);
}

function notepad_report_checker(){
	if($('#notepad-report').val()){
		window.onbeforeunload = onbeforeunload_handler;
	}else{
		window.onbeforeunload = false;
	}
}

function onbeforeunload_handler (){
	var message = "{LA_MVT_EXIT_ALERT}",
	e = e || window.event;

	//IE and Firefox
	if (e) {
		e.returnValue = message;
	}
	// Safari
	return message;
}

function set_onbeforeunload_handler(handler){
	window.onbeforeunload = handler;
}

function exit_handler(url){
	if($('#notepad-report').val()){
		mvt_confirm("{LA_MVT_INFORMATION}", "{LA_MVT_EXIT_ALERT}", 
			function () {
				window.onbeforeunload = false;
				window.location.href = url;
			}, 
			function () {
				$('#notepad').show(300);
				$('#btn_notepad').children('a').addClass('active');
			}
		);
	}else{
		window.location.href = url;
	}
	return false;
}

function version_differentiator(){
	$.ajax({
		type: 'POST',
		url: '{U_AJAX}',
		data: {'mode' : 'differentiator', 'mod' : current_mod, 'mod_versions' : current_mod_versions, 'file' : current_file},
		timeout: 5000,
		dataType  : 'json',
		beforeSend: function() {

		},
		complete: function(data, textStts, errThrown) {

		},
		success: function(data, textStts, errThrown) {
			var version_differentiator = '', separator = '&nbsp;&bull;&nbsp;', i = 0;
			if(data['diff']){
				for(version in data['diff']){
					if(version == current_mod_version){
						continue;
					}
					if(data['diff'][version] === true){
						version_differentiator += ((i ? separator : '' ) + version + ': <span class="success">{LA_MVT_FILE_UNMODIFIED}</span>');
					}else if(data['diff'][version] === false){
						version_differentiator += ((i ? separator : '' ) + version + ': <span class="error">{LA_MVT_FILE_MODIFIED}</span>');
					}else{
						version_differentiator += ((i ? separator : '' ) + version + ': <span class="error">{LA_MVT_FILE_MISSING}</span>');
					}
					i++;
				}
				$('#version-differentiator').html(version_differentiator);
			}
		},
		error: function(data, textStts, errThrown) {

		},
	});
}

function set_active_file(file, collapse_on_complete){
	if(busy){
		return;
	}
	$.ajax({
		type: 'POST',
		url: '{U_AJAX}',
		data: {'mod' : current_mod, 'file' : file},
		timeout: 10000,
		beforeSend: function() {
			$('html, body').addClass('busy');
			busy = true;
			$("#code-content").html('<p class="loading"><img alt="{LA_MVT_LOADING}" src="style/images/loading.gif"></p>');
		},
		complete: function(data, textStts, errThrown) {
			$('html, body').removeClass('busy');
			$('#code-content').find("a").attr("onclick", "window.open(this.href); return false;");
			if(collapse_on_complete){
				collapse_all();
			}
			busy = false;
		},
		success: function(data, textStts, errThrown) {
			$("#code-content").html(data);
			$('html, body').animate({
				scrollTop: $("#tools").offset().top
			}, 250);
			$('#code-content').animate({
				scrollTop: '-=999999'
			}, 300);
			current_file = file;
			current_file_ext = strrchr(file, '.').substr(1);
			set_button_status();
			$('title').text('{LA_MVT} | ' + current_real_mod + ' » ' + file);
			$('#breadcrumb').text('{LA_MVT} » ' + current_real_mod + ' » ' + file);
			$('#btn_compare').children('a').removeClass('active');
			<!-- IF .version_selector -->
			version_differentiator();
			<!-- ENDIF -->

			//Small hack to allow users to use link as shortcut even with hash :)
			hash_ignore_update = true;
			window.location = '#' + file;
			file_encoding(current_mod, current_file, false);
			file_eol(current_mod, current_file, false);
		},
		error: function(data, textStts, errThrown) {

		},
	});
}

function set_button_status(){
	for(key in ext_association){
		if(typeof(ext_association[key]) != 'undefined'){
			dance: for(subkey in ext_association[key]){
				$('#' + key).hide();
				if(ext_association[key][subkey] == current_file_ext){
					$('#' + key).show();
					break dance;
				}
			}
		}
	}
	for(key in ext_unassociation){
		if(typeof(ext_unassociation[key]) != 'undefined'){
			inbad : for(subkey in ext_unassociation[key]){
				$('#' + key).show();
				if(ext_unassociation[key][subkey] == current_file_ext){
					$('#' + key).hide();
					break inbad;
				}
			}
		}
	}
}

function insert_filename(){
	$("#btn_filename").effect('transfer', {to: "#notepad-button", className: "ui-effects-transfer" }, 500,
		function () {
			$("#notepad-button").effect('highlight', {color:"#669966"}, 500);
			$('#notepad-report').val($('#notepad-report').val() + "[b][size=110]" + current_file + "[/size][/b]\n").trigger('autosize.resize');
		}
	);
}

function report_code(err_code){
	var SelectedCode = getSelectedCode();
	var btns = {}, cwBtn = '{LA_MVT_CANCEL}', awBtn = '{LA_MVT_ADD_TO_REPORT}';
	if(!SelectedCode)
	{
		alert('{LA_MVT_SELECT_ERROR}');
		return;
	}

	mvt_confirm("{LA_MVT_INFORMATION}", "{LA_MVT_DESCRIBE}", 
		function () {
			$("#user-report").effect('transfer', {to: "#notepad-button", className: "ui-effects-transfer" }, 500,
				function () {
					$('#notepad-report').val($('#notepad-report').val() + "[b]" + err_code + "[/b]\n[code]" + SelectedCode + "[/code]" + $('#user-report').val() + "\n\n").trigger('autosize.resize');
					$("#notepad-button").effect('highlight', {color:"#669966"}, 500);
					$('#user-report').val('');
				}
			);
		}, 
		function () {
		}, false, '#dialogbox'
	);
}

function purge_notepad(){
	mvt_confirm("{LA_MVT_INFORMATION}", "{LA_MVT_PURGE_CONFIRM}", 
		function () {
			$('#notepad-report').val('').trigger('autosize.resize');
		}, 
		function () {
		}, true
	);
}

function get_filestats(){
	if(busy){
		return;
	}
	$.ajax({
		type: 'POST',
		url: '{U_AJAX}',
		data: {'mod' : '{S_CURRENT_MOD}', 'file' : current_file, 'mode' : 'filestats'},
		timeout: 5000,
		dataType  : 'json',
		beforeSend: function() {
			busy = true;
		},
		complete: function(data, textStts, errThrown) {
			busy = false;
		},
		success: function(data, textStts, errThrown) {
			if(data['errmsg']){
				alert(data['errmsg']);
			}
			if(data['eval']){
				eval(data['eval']);
			}
		},
		error: function(data, textStts, errThrown) {

		},
	});
}

function check_syntax(){
	if(busy){
		return;
	}
	$.ajax({
		type: 'POST',
		url: '{U_AJAX}',
		data: {'mod' : '{S_CURRENT_MOD}', 'file' : current_file, 'mode' : 'syntax'},
		timeout: 5000,
		beforeSend: function() {
			busy = true;
		},
		complete: function(data, textStts, errThrown) {
			busy = false;
		},
		success: function(data, textStts, errThrown) {
			mvt_info("{LA_MVT_INFORMATION}", data, function(){});
		},
		error: function(data, textStts, errThrown) {

		},
	});
}

function delete_mod(mod_path){
	window.mod_to_delete = mod_path;
	var on_confirm = function(){
		$.ajax({
			type: 'POST',
			url: '{U_AJAX}',
			data: {'mod' : mod_to_delete, 'mode' : 'delete_mod'},
			timeout: 30000,
			async: false,
			dataType  : 'json',
			beforeSend: function() {
				
			},
			complete: function(data, textStts, errThrown) {

			},
			success: function(data, textStts, errThrown) {
				if(data['errmsg']){
					alert(data['errmsg']);
				}
				if(data['eval']){
					eval(data['eval']);
				}
			},
			error: function(data, textStts, errThrown) {

			},
		});
	};
	mvt_confirm('{LA_CONFIRM}', '{LA_MVT_MOD_DELETE_WARN}', on_confirm, function(){});
}

function internal_mesage(){
	var SelectedCode = getSelectedCode();
	mvt_confirm("{LA_MVT_INFORMATION}", "{LA_MVT_INTERNAL_EXPLAIN}", 
		function () {
			if(!$('#user-report').val())
			{
				alert('{LA_MVT_EMPTY_MESSAGE}');
				return;
			}
			$('#notepad-report').val($('#notepad-report').val() + "[quote][size=120][b]{LA_MVT_INTERNAL}:[/b][/size]" + ((SelectedCode) ? "\n\n[b][size=110]" + current_file + "[/size][/b][code]" + SelectedCode + "[/code]" : '') + "\n\n" + $('#user-report').val() + "[/quote]\n").trigger('autosize.resize');
			$("#user-report").effect('transfer', {to: "#notepad-button", className: "ui-effects-transfer" }, 500,
				function () {
					$("#notepad-button").effect('highlight', {color:"#669966"}, 500);
					$('#user-report').val('');
				}
			);
		}, 
		function () {
		}, false, '#dialogbox'
	);
}
// ]]>
</script>